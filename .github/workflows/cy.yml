name: Run Cypress Tests

on:
  workflow_dispatch:
    inputs:
      test_type:
        description: 'Selecione o tipo de teste a ser executado'
        required: true
        default: 'api'
        type: choice
        options:
          - api
          - e2e

jobs:
  run-tests:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Code
        uses: actions/checkout@v2

      - name: Set up Node.js
        uses: actions/setup-node@v2
        with:
          node-version: '16'

      - name: Install Dependencies
        run: |
          npm install

      - name: Run Cypress Tests
        run: |
          if [ "${{ github.event.inputs.test_type }}" == "api" ]; then
            npm run cy-api:run  # Comando para rodar os testes de API
          else
            npm run cy-e2e:run  # Comando para rodar os testes E2E
          fi

generate-report:
    needs: run-tests  # Garante que este job execute somente após o job 'run-tests' finalizar
    runs-on: ubuntu-latest
    steps:
      - name: Generate Allure Report
        run: |
          allure generate allure-results --clean -o allure-report  # Gera o relatório Allure

      - name: Upload Allure Report to GitHub Pages (opcional)
        uses: peaceiris/actions-gh-pages@v3
        if: success()  # Somente se os testes passarem
        with:
          folder: allure-report  # O diretório onde o relatório foi gerado
          target_branch: gh-pages  # A branch onde será feito o upload
          commit_message: 'Deploy Allure Report'  # Mensagem do commit